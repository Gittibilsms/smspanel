@model List<GittBilSmsCore.ViewModels.ShortUrlViewModel>

<div class="card">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0"># @SharedResource.Short_URL</h4>
            <a href="/ShortUrls/Create" class="btn btn-primary d-flex align-items-center justify-content-center">
                <i class="bi bi-plus-lg"></i> @SharedResource.Create_Short_URL
            </a>
        </div>

        @if (Model != null && Model.Any())
        {
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>@SharedResource.Short_URL</th>
                            <th>@SharedResource.Destination_URL</th>
                            <th>@SharedResource.Title</th>
                            <th>@SharedResource.Clicks</th>
                            <th>@SharedResource.Status</th>
                            <th>@SharedResource.Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center gap-2">
                                        <a href="@item.ShortUrl" target="_blank" class="text-primary">@item.ShortUrl</a>
                                        <button class="btn btn-sm btn-link p-0" onclick="copyToClipboard('@item.ShortUrl')" title="Copy">
                                            <i class="bi bi-clipboard"></i>
                                        </button>
                                    </div>
                                </td>
                                <td>
                                    @{
                                        var url = item.OriginalUrl;
                                        var displayUrl = url.Length > 50 ? url.Substring(0, 50) + "..." : url;
                                    }
                                    <span title="@url">@displayUrl</span>
                                </td>
                                <td>@(item.Title ?? "-")</td>
                                <td>
                                    <span class="badge bg-info">@item.TotalClicks</span>
                                    @if (item.MaxClicks.HasValue)
                                    {
                                        <span class="text-muted">/ @item.MaxClicks</span>
                                    }
                                </td>
                                <td>
                                    @if (!item.IsActive)
                                    {
                                        <span class="badge bg-secondary">Inactive</span>
                                    }
                                    else if (item.ExpiryDate.HasValue && item.ExpiryDate < DateTime.Now)
                                    {
                                        <span class="badge bg-warning">Expired</span>
                                    }
                                    else if (item.MaxClicks.HasValue && item.TotalClicks >= item.MaxClicks)
                                    {
                                        <span class="badge bg-warning">Max Clicks</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-success">Active</span>
                                    }
                                </td>
                                <td>
                                    <a href="/ShortUrls/Edit/@item.Id" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <form method="post" action="/ShortUrls/Delete/@item.Id" style="display:inline;"
                                          onsubmit="return confirm('Are you sure you want to delete this short URL?');">
                                        @Html.AntiForgeryToken()
                                        <button type="submit" class="btn btn-sm btn-outline-danger">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="text-center py-5">
                <i class="bi bi-link-45deg" style="font-size: 4rem; color: #ccc;"></i>
                <h4 class="mt-3">No short URLs yet</h4>
                <p class="text-muted">Create your first short URL to get started</p>
                <a href="/ShortUrls/Create" class="btn btn-primary mt-3">
                    <i class="bi bi-plus-lg"></i> Create Short URL
                </a>
            </div>
        }
    </div>
</div>
@section Scripts {
    <script>
            function copyToClipboard(text) {
        var fullUrl = text.startsWith('http') ? text : window.location.origin + text;
                  navigator.clipboard.writeText(fullUrl).then(function() {
                      toastr.success('Copied to clipboard!');
                  }).catch(function() {
                      toastr.error('Failed to copy');
                  });
              }
    </script>
}